
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SNMP traps &#8212; Centreon 2.8.16 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Poller" href="../poller/index.html" />
    <link rel="prev" title="Recurrent downtimes" href="recurrent_downtimes.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../poller/index.html" title="Poller"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="recurrent_downtimes.html" title="Recurrent downtimes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Centreon 2.8.16 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Configuration</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Advanced configuration</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="snmp-traps">
<span id="configuration-advanced-snmptrapds"></span><h1>SNMP traps<a class="headerlink" href="#snmp-traps" title="Permalink to this headline">¶</a></h1>
<div class="section" id="definition">
<h2>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h2>
<p>SNMP traps are information sent using the SNMP protocol from monitored equipment to a poller server (satellite). This information contains multiple Attributes including:</p>
<ul class="simple">
<li>Address of the equipment sending the information.</li>
<li>The root OID (Object Identifier) corresponding to the identifier of the message received.</li>
<li>The message sent via the SNMP trap which corresponds to a set of settings (1 to N).</li>
</ul>
<p>In order to be able interpret the event received the Network supervisor server needs to possess in its configuration the necessary elements to translate the event. For this it must have a database containing the OID and the descriptions, this is what is called MIB files. There are two types of MIB:</p>
<ul class="simple">
<li>Standard MIBs which use standardised OIDs and which are implemented by numerous manufacturers on their equipment.</li>
<li>MIB manufacturers who are specific to each one and often to each equipment model.</li>
</ul>
<p>MIB manufacturers can be retrieved from the equipment. Centreon allows us to store the definition of SNMP traps in its MySQL database. The traps can subsequently be linked to passive services via the <strong>Relations</strong> tab of the definition of a service.</p>
</div>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>With centreon 2.5.x, the management of the SNMP traps has been reviewed completely in comparison to the previous versions:</p>
<ul class="simple">
<li>The ‘snmptt’ and ‘centtraphandler’ processes have been combined in a single process called ‘centreontrapd’.</li>
<li>The ‘snmptthandler’ process is replaced by the ‘centreontrapdforward’ process.</li>
<li>The satellites can have their own definition of SNMP traps within a SQLite dedicated base thus deleting the access to the centreon MySQL server.</li>
</ul>
<div class="section" id="processing-of-a-trap-by-the-central-server">
<h3>Processing of a trap by the central server<a class="headerlink" href="#processing-of-a-trap-by-the-central-server" title="Permalink to this headline">¶</a></h3>
<p>Here is the processing of an SNMP trap with centreon 2.5.x:</p>
<ol class="arabic simple">
<li>snmptrapd is the service enabling the retrieval of SNMP traps sent by the equipment (by default it listens on the <strong>UDP 162</strong> port).</li>
<li>Once the SNMP trap has been received, it is sent to the ‘centreontrapdforward’ script which writes the information received in a buffer folder (by default <strong>/var/spool/centreontrapd/</strong>).</li>
<li>The ‘centreontrapd’ service reads the information received in the buffer folder and interprets the traps received checking, in the centreon database, the actions necessary to process these events.</li>
<li>The ‘centreontrapd’ service transmits the information to the scheduler or the ‘centcore’ service (to send the information to a remote scheduler) which changes the status and the information associated with service to which the SNMP trap is linked.</li>
</ol>
<img alt="../../_images/06_trap_centreon.png" class="align-center" src="../../_images/06_trap_centreon.png" />
</div>
<div class="section" id="processing-of-a-trap-by-a-satellite-server">
<h3>Processing of a trap by a satellite server<a class="headerlink" href="#processing-of-a-trap-by-a-satellite-server" title="Permalink to this headline">¶</a></h3>
<p>To keep a copy of the configuration of the SNMP traps on each satellite server, a SQLite database is charged with keeping cached the information of the traps contained in the MySQL database. This SQLite database is automatically generated by the central server. Here is the processing of an SNMP trap with centreon 2.5.x :</p>
<ol class="arabic simple">
<li>snmptrapd is the service serving to retrieve the SNMP traps sent by the equipment (by default it listens on the <strong>UDP 162</strong> port).</li>
<li>Once the SNMP trap is received, it is sent to the ‘centreontrapdforward’ script which writes the information received in a buffer folder (by default <strong>/var/spool/centreontrapd/</strong>).</li>
<li>The ‘centreontrapd’ service reads the information received in the buffer folder and interprets the various traps received checking in the SQLite database the actions to be taken to process the traps received.</li>
<li>The ‘centreontrapd’ service transmits the information to the scheduler which changes the status and the information associated with the service to which the SNMP trap is linked.</li>
</ol>
<img alt="../../_images/06_trap_poller.png" class="align-center" src="../../_images/06_trap_poller.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the Centcore process is responsible, as for the export of configuration of the supervision, to copy the SQLite base on the remote collector.</p>
</div>
</div>
</div>
<div class="section" id="configuration-of-services">
<h2>Configuration of services<a class="headerlink" href="#configuration-of-services" title="Permalink to this headline">¶</a></h2>
<div class="section" id="snmptrapd">
<h3>Snmptrapd<a class="headerlink" href="#snmptrapd" title="Permalink to this headline">¶</a></h3>
<p>To call the ‘centreontrapdfoward’ script, the file <strong>/etc/snmp/snmptrapd.conf</strong> must contain the following lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">disableAuthorization</span> <span class="n">yes</span>
<span class="n">traphandle</span> <span class="n">default</span> <span class="n">su</span> <span class="o">-</span><span class="n">l</span> <span class="n">centreon</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;/usr/share/centreon/bin/centreontrapdforward&quot;</span>
</pre></div>
</div>
<p>You can optimise the performances of snmptrapd by using the following options:</p>
<ul class="simple">
<li><strong>-On</strong> don’t try to convert the OIDs</li>
<li><strong>-t</strong> don’t log the traps to the syslog server</li>
<li><strong>-n</strong> don’t try to convert the IP addresses into host names</li>
</ul>
<p>These options can be changed in the file <strong>/etc/sysconfig/snmptrapd</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-On -d -t -n -p /var/run/snmptrapd.pid&quot;</span>
</pre></div>
</div>
<p>It is also possible to place the snmptrapd buffer folder in the RAM. For this, add the following line in the file <strong>/etc/fstab</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tmpfs</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">snmpd</span>                     <span class="n">tmpfs</span> <span class="n">defaults</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">128</span><span class="n">m</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="centreontrapdforward">
<span id="configuration-advanced-centreontrapdforward"></span><h3>centreontrapdforward<a class="headerlink" href="#centreontrapdforward" title="Permalink to this headline">¶</a></h3>
<p>To change the buffer folder towards which the information will be written, change the configuration file <strong>/etc/centreon/centreontrapd.pm</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">our</span> <span class="o">%</span><span class="n">centreontrapd_config</span> <span class="o">=</span> <span class="p">(</span>
          <span class="n">spool_directory</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/spool/centreontrapd/&#39;</span><span class="p">,</span>
<span class="p">);</span>

<span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>You can also map the folder in the RAM, by adding the following line in the file: <strong>/etc/fstab</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tmpfs</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">centreontrapd</span>            <span class="n">tmpfs</span> <span class="n">defaults</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">512</span><span class="n">m</span> <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="centreontrapd">
<span id="configuration-advanced-centreontrapd"></span><h3>centreontrapd<a class="headerlink" href="#centreontrapd" title="Permalink to this headline">¶</a></h3>
<p>Two configuration files existent in centreontrapd:</p>
<ul class="simple">
<li><strong>/etc/centreon/conf.pm</strong> contains the connection information to the MySQL database</li>
<li><strong>/etc/centreon/centreontrapd.pm</strong> contains the configuration of the centreontrapd service</li>
</ul>
<div class="section" id="configuration-of-the-service">
<h4>Configuration of the service<a class="headerlink" href="#configuration-of-the-service" title="Permalink to this headline">¶</a></h4>
<p>In the file <strong>/etc/centreon/centreontrapd.pm</strong> we advise changing three settings only (if necessary):</p>
<ul class="simple">
<li>If the <strong>mode</strong> option is defined in 1 centreontrapd functions on a satellite server, otherwise it functions on a central server (centreon).</li>
<li>The <strong>centreon_user</strong> option can be used to change the user executing the actions.</li>
<li>The <strong>spool_directory</strong> option can be used to change the buffer folder to be read (if you have changed it in the ‘centreontrapdforward’ configuration file).</li>
</ul>
<p>Here is an example of possible configuration of the file <strong>/etc/centreon/centreontrapd.pm</strong> (the configuration file can be changed with ‘-config-extra = xxx’):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">our</span> <span class="o">%</span><span class="n">centreontrapd_config</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Time in seconds before killing not gently sub process</span>
    <span class="n">timeout_end</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">spool_directory</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/spool/centreontrapd/&quot;</span><span class="p">,</span>
    <span class="c1"># Delay between spool directory check new files</span>
    <span class="n">sleep</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="c1"># 1 = use the time that the trap was processed by centreontrapdforward</span>
    <span class="n">use_trap_time</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">net_snmp_perl_enable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">mibs_environment</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">remove_backslash_from_quotes</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">dns_enable</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="c1"># Separator for arguments substitution</span>
    <span class="n">separator</span> <span class="o">=&gt;</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
    <span class="n">strip_domain</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">strip_domain_list</span> <span class="o">=&gt;</span> <span class="p">[],</span>
    <span class="n">duplicate_trap_window</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">date_format</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">time_format</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">date_time_format</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># Internal OID cache from database</span>
    <span class="n">cache_unknown_traps_enable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Time in seconds before cache reload</span>
    <span class="n">cache_unknown_traps_retention</span> <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
    <span class="c1"># 0 = central, 1 = poller</span>
    <span class="n">mode</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">cmd_timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">centreon_user</span> <span class="o">=&gt;</span> <span class="s2">&quot;centreon&quot;</span><span class="p">,</span>
    <span class="c1"># 0 =&gt; skip if MySQL error | 1 =&gt; dont skip (block) if MySQL error (and keep order)</span>
    <span class="n">policy_trap</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Log DB</span>
    <span class="n">log_trap_db</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">log_transaction_request_max</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">log_transaction_timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">log_purge_time</span> <span class="o">=&gt;</span> <span class="mi">600</span>
<span class="p">);</span>

<span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-of-the-connection-to-the-database">
<h4>Configuration of the connection to the database<a class="headerlink" href="#configuration-of-the-connection-to-the-database" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On a poller, the database access should be configure in <strong>/etc/centreon/centreontrapd.pm</strong> file.</p>
</div>
<p>It is possible of configure the file <strong>/etc/centreon/conf.pm</strong> in two ways:</p>
<ul>
<li><p class="first">Retain the connection to the MySQL server database (necessary for the central server and possible for the satellite servers). Content of the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$centreon_config = {
VarLib =&gt; &quot;/var/lib/centreon&quot;,
CentreonDir =&gt; &quot;/usr/share/centreon/&quot;,
&quot;centreon_db&quot; =&gt; &quot;centreon&quot;,
&quot;centstorage_db&quot; =&gt; &quot;centreon_storage&quot;,
&quot;db_host&quot; =&gt; &quot;localhost:3306&quot;,
&quot;db_user&quot; =&gt; &quot;centreon&quot;,
&quot;db_passwd&quot; =&gt; &quot;centreon&quot;
};

1;
</pre></div>
</div>
</li>
<li><p class="first">Connect centreontrapd to the local SQLite database. Contents of the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$centreon_config = {
VarLib =&gt; &quot;/var/lib/centreon&quot;,
CentreonDir =&gt; &quot;/usr/share/centreon/&quot;,
&quot;centreon_db&quot; =&gt; &quot;dbname=/etc/snmp/centreon_traps/centreontrapd.sdb&quot;,
&quot;centstorage_db&quot; =&gt; &quot;dbname=/etc/snmp/centreon_traps/centreontrapd.sdb&quot;,
&quot;db_host&quot; =&gt; &quot;&quot;,
&quot;db_user&quot; =&gt; &quot;&quot;,
&quot;db_passwd&quot; =&gt; &quot;&quot;,
&quot;db_type&quot; =&gt; &#39;SQLite&#39;,
};

1;
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="centreon-configuration">
<h2>Centreon configuration<a class="headerlink" href="#centreon-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-a-manufacturer">
<span id="configuration-advanced-snmptrapds-manufacturer"></span><h3>Add a manufacturer<a class="headerlink" href="#add-a-manufacturer" title="Permalink to this headline">¶</a></h3>
<p>Within centreon, the root OIDs of the SNMP traps is filed by manufacturer. To add a manufacturer:</p>
<ol class="arabic simple">
<li>Go into the menu: <strong>Configuration ==&gt; SNMP traps</strong></li>
<li>In the left menu, click on <strong>Manufacturer</strong></li>
<li>Click on <strong>Add</strong></li>
</ol>
<img alt="../../_images/06constructors.png" class="align-center" src="../../_images/06constructors.png" />
<ul class="simple">
<li>The <strong>Name</strong> and <strong>Alias</strong> fields define the name and the alias of the manufacturer</li>
<li>The <strong>Description</strong> field provides an indication about the manufacturer</li>
</ul>
</div>
<div class="section" id="importation-of-mibs">
<span id="configuration-advanced-snmptrapds-mibimport"></span><h3>Importation of MIBs<a class="headerlink" href="#importation-of-mibs" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to import OIDs from MIBs provided by the manufacturers. To do this :</p>
<ol class="arabic simple">
<li>Go into the menu: <strong>Configuration ==&gt; SNMP traps</strong></li>
<li>In the left menu, click on <strong>MIBs</strong></li>
</ol>
<img alt="../../_images/06importmibs.png" class="align-center" src="../../_images/06importmibs.png" />
<ul class="simple">
<li>The <strong>Manufacturer</strong> list can be used to choose the manufacturer to which the MIB that you are importing  belongs</li>
<li>The <strong>File (.mib)</strong> field can be used to load the MIB</li>
</ul>
<ol class="arabic simple" start="3">
<li>Click on <strong>Import</strong></li>
</ol>
<img alt="../../_images/06importmibssuccess.png" class="align-center" src="../../_images/06importmibssuccess.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The dependencies of the MIBS that you import must be present in the folder <strong>/usr/share/snmp/mibs</strong>. Once the import is completed, delete the dependences previously copied.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once the SNMP traps are imported, it is necessary to verify the “Monitoring” status associated with the events. By default it will be “OK”.</p>
</div>
</div>
<div class="section" id="manual-configuration-of-traps">
<h3>Manual configuration of traps<a class="headerlink" href="#manual-configuration-of-traps" title="Permalink to this headline">¶</a></h3>
<div class="section" id="basic-configuration">
<h4>Basic configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h4>
<p>It is also possible to create definitions of SNMP traps manually:</p>
<ol class="arabic simple">
<li>Go into the menu: <strong>Configuration ==&gt; SNMP traps</strong></li>
<li>Click on <strong>Add</strong></li>
</ol>
<img alt="../../_images/06addsnmptrap.png" class="align-center" src="../../_images/06addsnmptrap.png" />
<ul class="simple">
<li>The field <strong>Trap name</strong> defines the name of the trap.</li>
<li>The field <strong>OID</strong> defines the Root OID to be received for this trap to be considered as received.</li>
<li>The field <strong>Vendor name</strong> defines the name of the manufacturer to which the trap to be selected in the drop-down list belongs.</li>
<li>The field <strong>Output message</strong> of contains the message to be displayed in the event of reception of a trap containing the OID configured above.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, the MIB contains the definition of this variable (E.g.: “Link up on interface $2. State: $4.”, here $2 will be replaced by the 2nd argument received in the event.). In the opposite situation, the variable <strong>$*</strong> can be used to display all the arguments contained in the trap.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to construct the output message yourself. For this, use the MIB to know the arguments that will be present in the body of the event and retrieve the arguments with the variables <strong>$n</strong>. As each argument is identified by a OID, it is possible to use this OID directly to place it in the output message without knowing its position via the variable <strong>&#64;{OID}</strong>.</p>
</div>
<ul class="simple">
<li>The <strong>Default status</strong> field defines the “monitoring” status of the service in case of reception of the trap.</li>
<li>If the <strong>Submit result</strong> box is checked the result is submitted to the Network supervisor engine.</li>
<li>The <strong>Comments</strong> field (last field) contains by default the comment by the manufacturer of the SNMP trap. Most of the time, this comment indicates the list of variables contained in the SNMP trap (see the next chapter on advanced configuration).</li>
</ul>
</div>
<div class="section" id="advanced-configuration-of-the-traps">
<h4>Advanced configuration of the traps<a class="headerlink" href="#advanced-configuration-of-the-traps" title="Permalink to this headline">¶</a></h4>
<p>It is possible to determine the status of a service from the value of a setting of the SNMP trap rather than from the Root OID. Previously the manufacturer defined an SNMP trap (Root OID) by type of event to be sent (linkUp / linkDown). Today, the tendency is to define a Root OID by category of events and then to define the event via a set of settings.</p>
<p>To do this, it is possible of define <strong>Advanced Matching mode</strong> by clicking on <strong>Add a new entry</strong> and by creating as many rules as necessary.
For each rule, define the settings:</p>
<ul class="simple">
<li><strong>String</strong> defines the element on which the search will be applied (&#64;OUTPUT&#64; defined all the <strong>Output messages</strong> translated).</li>
<li><strong>Regexp</strong> defined the REGEXP type search to be applied.</li>
<li><strong>Status</strong> defines the status of the service in the event of concordance.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The order is important in the rules of correspondence because the process will stop at the first rule of which the correspondence is assured.</p>
</div>
<ul class="simple">
<li>The <strong>Disable submit result if no matched rules</strong> field disables the sending of information to the scheduling engine if no correspondence with a rule is confirmed.</li>
<li>If the <strong>Reschedule associated services</strong> box is checked the next check on the service, which should be ‘active’, should be reprogrammed as soon as possible after reception of the trap.</li>
<li>If the <strong>Execute special command</strong> box is checked the command defined in Special command is executed.</li>
</ul>
</div>
<div class="section" id="very-advanced-configuration-of-the-traps">
<h4>Very advanced configuration of the traps<a class="headerlink" href="#very-advanced-configuration-of-the-traps" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Advanced</strong> tab serves to configure the behavior of the handling process of the SNMP traps on its reception of the latter.</p>
<img alt="../../_images/06advancedconfiguration.png" class="align-center" src="../../_images/06advancedconfiguration.png" />
<ul class="simple">
<li><strong>Enable routing</strong> is used to enable the routing of information.</li>
<li><strong>Route definition</strong> is used to define the command to be used for routing.</li>
</ul>
<p>Before performing the processing of the event (translation of the <strong>Output message</strong>), it is possible to execute a command called PREEXEC. To do this, it is possible to define <strong>PREEXEC command (SNMPTT type)</strong> by clicking on <strong>Add a new entry</strong> and create as many rules as necessary.</p>
<ul class="simple">
<li><strong>PREEXEC command</strong> defines the command to be executed.</li>
</ul>
<p>Here is an example of use with the linkUP trap:</p>
<p>For a Cisco equipment, $2 == ifDescr contains the port number of the interface (GigabitEthernet0/1 for instance).
The best description of the interface is in the SNMP if Alias field.</p>
<p>The following command can be used to retrieve this value :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>snmpget -v 2c -Ovq -c &lt;community&gt; &lt;cisco switch&gt; ifAlias.$1
</pre></div>
</div>
<p>To use the result of the PREEXEC command in the <strong>Output message</strong>, it is necessary to use the variable $p{n} where ‘n’ corresponds to the order of definition of the command.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Interface $2 ( $p1 ) linkUP. State: $4.&quot;</span> <span class="s2">&quot;$CA&quot;</span>
</pre></div>
</div>
<p>The result will have the form:  Interface GigabitEthernet0/1 ( NAS Server ) linkUP. State: up</p>
<ul class="simple">
<li>The <strong>Insert trap’s information into database</strong> box, if checked, record the SNMP trap information in the database field can be used define whether or not to classify the traps by day in the database.</li>
<li>The <strong>Timeout</strong> field expressed in seconds is used to define the maximum processing time of the event including the pre-processing commands (PREEXEC) and post-processing commands (special command).</li>
<li>The <strong>Execution interval</strong> field expressed in seconds is used to define the maximum waiting time between two processing operations of an event.</li>
<li>The <strong>Execution Type</strong> field is used to enable the Execution interval by defining the conditions by Root OID, by the Root OID and host combination or, to disable this restriction, None.</li>
<li>The <strong>Execution Method</strong> field is used to define if on reception of multiple same events (Root OID). The execution is either <strong>Sequential</strong> or <strong>Parallel</strong>.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<p>When adding a rule of correspondence or executing a special command it is possible to transmit arguments to the <strong>String</strong> or <strong>Special command</strong> fields. These arguments are listed in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Macro name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#64;{NUMERIC_OID}</td>
<td>Retrieval of the value of an argument via its OID, e.g.: &#64;{.1.3.6.1.4.1.9.9.43.1.1.1}</td>
</tr>
<tr class="row-odd"><td>$1, $2…</td>
<td>Retrieval of the value of an argument via its order of appearance</td>
</tr>
<tr class="row-even"><td>$p1, $p2,…</td>
<td>Value of the command: PREEXEC ($p1 = at the first command, $p2 at the second, …)</td>
</tr>
<tr class="row-odd"><td>$*</td>
<td>All the arguments separated by a space</td>
</tr>
<tr class="row-even"><td>&#64;HOSTNAME&#64;</td>
<td>Host name (in centreon) to which the service is attached</td>
</tr>
<tr class="row-odd"><td>&#64;HOSTADDRESS&#64;</td>
<td>IP address of the host sending the trap</td>
</tr>
<tr class="row-even"><td>&#64;HOSTADDRESS2&#64;</td>
<td>DNS name of the host sending the trap (if the server fails to effect a reverse DNS resolution we retrieve the IP address)</td>
</tr>
<tr class="row-odd"><td>&#64;SERVICEDESC&#64;</td>
<td>Service name</td>
</tr>
<tr class="row-even"><td>&#64;TRAPOUTPUT&#64; ou &#64;OUTPUT&#64;</td>
<td>Output of the traps</td>
</tr>
<tr class="row-odd"><td>&#64;STATUS&#64;</td>
<td>Service state</td>
</tr>
<tr class="row-even"><td>&#64;SEVERITYNAME&#64;</td>
<td>Criticality name</td>
</tr>
<tr class="row-odd"><td>&#64;SEVERITYLEVEL&#64;</td>
<td>Criticality level</td>
</tr>
<tr class="row-even"><td>&#64;TIME&#64;</td>
<td>Trap reception timestamp</td>
</tr>
<tr class="row-odd"><td>&#64;POLLERID&#64;</td>
<td>ID of the poller having received the trap</td>
</tr>
<tr class="row-even"><td>&#64;POLLERADDRESS&#64;</td>
<td>IP address of the poller having received the trap</td>
</tr>
<tr class="row-odd"><td>&#64;CMDFILE&#64;</td>
<td>Path to the command file of CentCore (central) or of centreon Engine (collector)</td>
</tr>
</tbody>
</table>
<p>In addition, there are special variables that can be used in the <strong>Routing settings</strong> section at the level of the <strong>Routing command</strong> if the option Enable routing is selected :</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Macro name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#64;GETHOSTBYADDR($1)&#64;</td>
<td>Reverse DNS resolution used to find the DNS name DNS from the IP address (127.0.0.1 -&gt; localhost)</td>
</tr>
<tr class="row-odd"><td>&#64;GETHOSTBYNAME($1)&#64;</td>
<td>DNS resolution used to find the IP address from the DNS name (localhost -&gt; 127.0.0.1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="applying-the-changes">
<span id="configuration-advanced-snmptrapds-generate-configuration"></span><h2>Applying the changes<a class="headerlink" href="#applying-the-changes" title="Permalink to this headline">¶</a></h2>
<p>To be able to export the OID present in the database in the configuration file to centreontrapd, follow the following procedure:</p>
<ol class="arabic simple">
<li>Go into the menu: <strong>Configuration ==&gt; SNMP traps</strong></li>
<li>In the left menu, click on <strong>Generate</strong></li>
<li>Select the poller to which you want to export the configuration files</li>
<li>Check <strong>Generate traps database</strong> and <strong>Apply configurations</strong></li>
<li>In the drop-down list <strong>Send signal</strong> (the <strong>Reload</strong> option is preferable)</li>
<li>Click on the <strong>Generate</strong> button</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SNMP traps</a><ul>
<li><a class="reference internal" href="#definition">Definition</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a><ul>
<li><a class="reference internal" href="#processing-of-a-trap-by-the-central-server">Processing of a trap by the central server</a></li>
<li><a class="reference internal" href="#processing-of-a-trap-by-a-satellite-server">Processing of a trap by a satellite server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-of-services">Configuration of services</a><ul>
<li><a class="reference internal" href="#snmptrapd">Snmptrapd</a></li>
<li><a class="reference internal" href="#centreontrapdforward">centreontrapdforward</a></li>
<li><a class="reference internal" href="#centreontrapd">centreontrapd</a><ul>
<li><a class="reference internal" href="#configuration-of-the-service">Configuration of the service</a></li>
<li><a class="reference internal" href="#configuration-of-the-connection-to-the-database">Configuration of the connection to the database</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#centreon-configuration">Centreon configuration</a><ul>
<li><a class="reference internal" href="#add-a-manufacturer">Add a manufacturer</a></li>
<li><a class="reference internal" href="#importation-of-mibs">Importation of MIBs</a></li>
<li><a class="reference internal" href="#manual-configuration-of-traps">Manual configuration of traps</a><ul>
<li><a class="reference internal" href="#basic-configuration">Basic configuration</a></li>
<li><a class="reference internal" href="#advanced-configuration-of-the-traps">Advanced configuration of the traps</a></li>
<li><a class="reference internal" href="#very-advanced-configuration-of-the-traps">Very advanced configuration of the traps</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#applying-the-changes">Applying the changes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="recurrent_downtimes.html"
                        title="previous chapter">Recurrent downtimes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../poller/index.html"
                        title="next chapter">Poller</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/configuration_guide/advanced_configuration/traps.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../poller/index.html" title="Poller"
             >next</a> |</li>
        <li class="right" >
          <a href="recurrent_downtimes.html" title="Recurrent downtimes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Centreon 2.8.16 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Configuration</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Advanced configuration</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2018 Centreon.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Managing SNMP traps with Centreon &#8212; Centreon 2.8.16 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuring Broker" href="02l.html" />
    <link rel="prev" title="Managing groups and categories" href="02j.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="02l.html" title="Configuring Broker"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="02j.html" title="Managing groups and categories"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Centreon 2.8.16 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Administration</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="managing-snmp-traps-with-centreon">
<h1>Managing SNMP traps with Centreon<a class="headerlink" href="#managing-snmp-traps-with-centreon" title="Permalink to this headline">¶</a></h1>
<div class="section" id="receive-snmp-traps-with-centreon">
<h2>Receive SNMP traps with Centreon<a class="headerlink" href="#receive-snmp-traps-with-centreon" title="Permalink to this headline">¶</a></h2>
<p>This section presents the different stages in order to monitor equipment using SNMP traps.</p>
<div class="section" id="import-of-snmp-traps">
<h3>Import of SNMP traps<a class="headerlink" href="#import-of-snmp-traps" title="Permalink to this headline">¶</a></h3>
<p>To import SNMP traps, you must follow the following steps:</p>
<ol class="arabic simple">
<li>Create a Manufacturer linked to the SNMP trap that you created, see this <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-snmptrapds-manufacturer"><span class="std std-ref">section</span></a></li>
<li>Import MiB in the Centreon web interface, see this <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-snmptrapds-mibimport"><span class="std std-ref">section</span></a></li>
</ol>
<p>When import a MiB file, it’s possible that dependences are necessary. In order to find the dependencies of your MIB, you must open your MIB file using a standard text editor, then:</p>
<ol class="arabic simple">
<li>Locate the line that starts with IMPORTS</li>
<li>All dependencies required to import your MIB file are after the keyword <strong>FROM</strong></li>
</ol>
<p>Eg. :</p>
<img alt="../_images/kdependances.png" class="align-center" src="../_images/kdependances.png" />
<p>In the MIB file shown above, there are four dependencies required to import the MIB: SNMPv2-SMI, SNMPv2-TC, SNMPv2-CONF, SNMP-FRAMEWORK-MIB.
Once the import is complete, it is necessary to modify the definition of the trap to change its default status:</p>
<ol class="arabic simple">
<li>Go into the menu <strong>Configuration</strong> ==&gt; <strong>SNMP Traps</strong></li>
<li>Click on the trap you want to modify.</li>
</ol>
<p>Depending on the associated trap message, change the default status of the service. In case the status of the service depends on the received message, use the advanced matching mode.</p>
</div>
<div class="section" id="create-a-passive-service-template">
<h3>Create a passive service template<a class="headerlink" href="#create-a-passive-service-template" title="Permalink to this headline">¶</a></h3>
<p>To facilitate the configuration of services using SNMP traps, it is more convenient to create a passive service template. In this way, when creating a service there will be more than inherit the service from this model and link the trap or SNMP traps linked to this service.</p>
<ol class="arabic simple">
<li>Go in the menu <strong>Configuration</strong> ==&gt; <strong>Services</strong></li>
<li>In the left menu click on <strong>Templates</strong></li>
<li>Click on <strong>Add</strong></li>
</ol>
<p>The table below summarizes all the attributes of a passive service template:</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attributes</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2"><strong>Service Configuration</strong> Tab</td>
</tr>
<tr class="row-odd"><td>Alias</td>
<td>TRAP</td>
</tr>
<tr class="row-even"><td>Service Template Name</td>
<td>generic-passive-service</td>
</tr>
<tr class="row-odd"><td>Check Period</td>
<td>24x7</td>
</tr>
<tr class="row-even"><td>Check Command</td>
<td>check_centreon_dummy</td>
</tr>
<tr class="row-odd"><td>Args</td>
<td>Status : 0
Output : “No trap since 24 hours”</td>
</tr>
<tr class="row-even"><td>Max Check Attempts</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>Active Checks Enabled</td>
<td>No</td>
</tr>
<tr class="row-even"><td>Passive Checks Enabled</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td colspan="2"><strong>Data Processing</strong> Tab</td>
</tr>
<tr class="row-even"><td>Check Freshness</td>
<td>TRAP</td>
</tr>
<tr class="row-odd"><td>Freshness Threshold</td>
<td>86400 (24 hours)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The check_centreon_dummy plugin will be called if no trap is received within 24 hours.</p>
</div>
</div>
<div class="section" id="service-creation">
<h3>Service creation<a class="headerlink" href="#service-creation" title="Permalink to this headline">¶</a></h3>
<p>Then create the service and associate it with the passive service template.
You just have to go to the <strong>Relations</strong> tab and linked in the field <strong>Service Trap Relation</strong>, SNMP traps that can change the status of the service.</p>
<p>Now <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-snmptrapds-generate-configuration"><span class="std std-ref">Generate configuration files</span></a> to apply changes.</p>
</div>
<div class="section" id="send-an-example-trap">
<h3>Send an example trap<a class="headerlink" href="#send-an-example-trap" title="Permalink to this headline">¶</a></h3>
<p>You can test the reception of SNMP traps on your device. You can send an fake SNMP event to your monitoring server using the utility line snmptrap orders.</p>
<p>Syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snmptrap</span> <span class="o">-</span><span class="n">v</span> <span class="n">SNMP</span><span class="o">-</span><span class="n">VERSION</span> <span class="o">-</span><span class="n">c</span> <span class="n">COMMUNITY</span> <span class="n">IP</span><span class="o">-</span><span class="n">DESTINATION</span> <span class="n">UPTIME</span> <span class="n">TRAP</span><span class="o">-</span><span class="n">OID</span> <span class="n">PARAMETER</span><span class="o">-</span><span class="n">OID</span> <span class="n">PARAMETER</span><span class="o">-</span><span class="n">TYPE</span> <span class="n">PARAMETER</span><span class="o">-</span><span class="n">VALUE</span>
</pre></div>
</div>
<p>With:</p>
<ul class="simple">
<li><strong>SNMP-VERSION</strong>: SNMP version. For the syntax above is necessarily 2c</li>
<li><strong>COMMUNITY</strong>: SNMP Community</li>
<li><strong>DESTINATION-IP</strong>: SNMP trap destination IP. It could be the Centreon central server or a poller.</li>
<li><strong>TRAP-OID</strong>: OID of the SNMP trap</li>
<li><strong>UPTIME</strong>: Time in seconds since last restart of the device. When an empty string is specified, this argument is automatically filled by the binary “snmptrap”.</li>
</ul>
<p>Any additional parameters to SNMP trap must contain the following 3 variables. They must be repeated for each additional parameter:</p>
<ul class="simple">
<li><strong>PARAMETER-OID</strong>:</li>
<li><strong>PARAMETER-TYPE</strong>: Type of the parameter, ‘i’ for ” Integer “, ‘s’ for ” String “, etc.</li>
<li><strong>PARAMETER-VALUE</strong>: related to the parameter value. Quoting a string containing spaces</li>
</ul>
<p>Trap example for sending “linkUp” event on ‘eth0’ interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snmptrap</span> <span class="o">-</span><span class="n">v2c</span> <span class="o">-</span><span class="n">c</span> <span class="n">public</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">6.1</span><span class="o">.</span><span class="mf">6.3</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span><span class="mf">5.4</span> <span class="n">ifIndex</span> <span class="n">i</span> <span class="mi">2</span> <span class="n">ifDescr</span> <span class="n">s</span> <span class="n">eth0</span> <span class="n">ifAdminStatus</span> <span class="n">i</span> <span class="mi">1</span> <span class="n">ifOperStatus</span> <span class="n">i</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="modify-the-output">
<h2>Modify the output<a class="headerlink" href="#modify-the-output" title="Permalink to this headline">¶</a></h2>
<div class="section" id="use-all-the-arguments">
<h3>Use all the arguments<a class="headerlink" href="#use-all-the-arguments" title="Permalink to this headline">¶</a></h3>
<p>For a SNMP trap, when configuring the output message, the argument $ * will display all the information (the value of arguments) contained within the SNMP trap. However, it is possible to display only certain information contained in the SNMP trap by calling unitarily arguments.</p>
<p>Eg:</p>
<img alt="../_images/klinkexample.png" class="align-center" src="../_images/klinkexample.png" />
<p>The output message “Link down on interface $2. State: $4.” will display only the name of the interface and its status ($2 and $4 argument).</p>
<p>Where can I find the arguments?</p>
<p>The arguments are in the documentation of the MIB manufacturer or in the <strong>Comments</strong> field of the SNMP trap.</p>
<p>Eg:</p>
<img alt="../_images/klinkcomment.png" class="align-center" src="../_images/klinkcomment.png" />
<p>To show:</p>
<ul class="simple">
<li>The index link, use the $1 argument</li>
<li>The interface name , use the $2 argument</li>
<li>The administrative state of the interface, use the $3 argument</li>
<li>The state interface, use the $4 argument</li>
</ul>
<p>Eg, the following output message displays all the arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Link down on interface: $2 (index: $1). Operational state: $4, Administration state: $3
</pre></div>
</div>
</div>
<div class="section" id="active-checks-after-trap-reception">
<h3>Active checks after trap reception<a class="headerlink" href="#active-checks-after-trap-reception" title="Permalink to this headline">¶</a></h3>
<p><strong>Reschedule associated services</strong> option to actively check the service after the trap reception.</p>
<p>The active service linked in the service configuration is executed.</p>
</div>
<div class="section" id="execute-special-command">
<h3>Execute special command<a class="headerlink" href="#execute-special-command" title="Permalink to this headline">¶</a></h3>
<p>Its possible with Centreontrapd to execute a special command after the reecption of a SNMP trap. Just use the option <strong>Execute special command</strong> followed by the description of this command.</p>
</div>
<div class="section" id="use-all-the-arguments-via-oid">
<h3>Use all the arguments (via OID)<a class="headerlink" href="#use-all-the-arguments-via-oid" title="Permalink to this headline">¶</a></h3>
<p>It’s also possible to have directly an argument value without knowing arguments order ($1, $2, $3, etc.). to do this, use the complete OID number of needed arguments.</p>
<p>Eg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Link</span> <span class="n">down</span> <span class="n">on</span> <span class="n">interface</span><span class="p">:</span> <span class="o">@</span><span class="p">{</span><span class="o">.</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">6.1</span><span class="o">.</span><span class="mf">2.1</span><span class="o">.</span><span class="mf">2.2</span><span class="o">.</span><span class="mf">1.2</span><span class="p">}</span> <span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="o">@</span><span class="p">{</span><span class="o">.</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">6.1</span><span class="o">.</span><span class="mf">2.1</span><span class="o">.</span><span class="mf">2.2</span><span class="o">.</span><span class="mf">1.1</span><span class="p">})</span><span class="o">.</span> <span class="n">Operational</span> <span class="n">state</span><span class="p">:</span> <span class="o">@</span><span class="p">{</span><span class="o">.</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">6.1</span><span class="o">.</span><span class="mf">2.1</span><span class="o">.</span><span class="mf">2.2</span><span class="o">.</span><span class="mf">1.8</span><span class="p">},</span> <span class="n">Administration</span> <span class="n">state</span><span class="p">:</span> <span class="o">@</span><span class="p">{</span><span class="o">.</span><span class="mf">1.3</span><span class="o">.</span><span class="mf">6.1</span><span class="o">.</span><span class="mf">2.1</span><span class="o">.</span><span class="mf">2.2</span><span class="o">.</span><span class="mf">1.7</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="use-an-external-variable">
<h3>Use an external variable<a class="headerlink" href="#use-an-external-variable" title="Permalink to this headline">¶</a></h3>
<p>It’s also possible to modify the output message by retrieving information via scripts or external commands and get the result to insert it in the output.
To do this, within the definition of your SNMP trap, go to the <strong>Advanced</strong> tab and add one (or more) preexec commands.</p>
<p>Eg:</p>
<img alt="../_images/kpreexec.png" class="align-center" src="../_images/kpreexec.png" />
<p>The first command “snmpget -v 2c -Ovq -c public &#64;HOSTADDRESS&#64; ifAlias.$1” and allows you to retrieve the alias interface. The “$1” variable is for the argument 1 associated value of linkUp/linkDown traps.</p>
<p>The second command “snmpget -v 2c -Ovq -c public &#64;HOSTADDRESS&#64; ifSpeed.$1” and allows you to retrieve interface speed. The “$1” variable is for the argument 1 associated value of linkUp/linkDown traps.</p>
<p>In order to exploit the result of the first command in the output, you have to use $p1 argument. For exploiting the result of the second command in output, you have to use $p2 argument.</p>
<p>Therefore, we can deduce the following output message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Link down on interface: $2 (index: $1). Operational state: $4, Administration state: $3, Alias : $p1, Speed : $p2
</pre></div>
</div>
</div>
<div class="section" id="use-a-regular-expression">
<h3>Use a Regular expression<a class="headerlink" href="#use-a-regular-expression" title="Permalink to this headline">¶</a></h3>
<p>It’s also possible to modify the output by using a regular expression with <strong>Output Transform</strong> option. You just have to define the regexp and it will be executed at trap reception.</p>
<p>For example</p>
<dl class="docutils">
<dt>::</dt>
<dd>s/|/-/g</dd>
</dl>
<p>Will replace <strong>|</strong> in the output to <strong>-</strong>.</p>
</div>
</div>
<div class="section" id="route-transfer-snmp-traps">
<h2>Route/Transfer SNMP traps<a class="headerlink" href="#route-transfer-snmp-traps" title="Permalink to this headline">¶</a></h2>
<p>It’s possible to have a SNMP trap concentrator. Eg: Oracle GRID.
Oracle GRID is responsible for federating information for all Oracle servers if necessary, it’s the Oracle GRID server who sends the SNMP trap to the monitoring server.</p>
<p>However, from a SNMP trap sent from Oracle GRID, we want to extract the IP address of the host and display the message in the service trap not belonging to Oracle Grid but to the correct host.</p>
<p>To do this, perform the following steps:</p>
<ol class="arabic simple">
<li>Create a generic trap, with the following parameters:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attributes</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2"><strong>Main</strong> Tab</td>
</tr>
<tr class="row-odd"><td>Trap Name</td>
<td>Trap name</td>
</tr>
<tr class="row-even"><td>OID</td>
<td>OID of the trap</td>
</tr>
<tr class="row-odd"><td>Default Status</td>
<td>Trap default status</td>
</tr>
<tr class="row-even"><td>Output Message</td>
<td>Custom output message</td>
</tr>
<tr class="row-odd"><td colspan="2"><strong>Advanced</strong> Tab</td>
</tr>
<tr class="row-even"><td>Enable routing</td>
<td>Checked</td>
</tr>
<tr class="row-odd"><td>Route definition</td>
<td>$2 (In this example $2 argument is for
IP address of the host)</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li>Create a second trap definition:</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attributes</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2"><strong>Main</strong> Tab</td>
</tr>
<tr class="row-odd"><td>Trap Name</td>
<td>Trap name (not the same as previous)</td>
</tr>
<tr class="row-even"><td>OID</td>
<td>OID of the trap (same as previous))</td>
</tr>
<tr class="row-odd"><td>Default Status</td>
<td>Trap default status</td>
</tr>
<tr class="row-even"><td>Output Message</td>
<td>Custom output message</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li>Associate the first definition to a service (eg PING) of Oracle GRID server</li>
<li>Associate the second definition to a passive service of the host.</li>
<li>Generate SNMP traps definitions and restart centreontrapd</li>
</ol>
<p>In the <strong>Route definition</strong> field you can use the following arguments:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#64;GETHOSTBYADDR($2)&#64;</td>
<td>Reverse DNS resolution to know the DNS name from IP address (127.0.0.1 -&gt; localhost)</td>
</tr>
<tr class="row-odd"><td>&#64;GETHOSTBYNAME($2)&#64;</td>
<td>DNS resolution to know the Ip address from the DNS (localhost -&gt; 127.0.0.1)</td>
</tr>
</tbody>
</table>
<div class="section" id="ignore-snmp-trap-when-resource-is-on-downtime">
<h3>Ignore SNMP Trap when resource is on downtime<a class="headerlink" href="#ignore-snmp-trap-when-resource-is-on-downtime" title="Permalink to this headline">¶</a></h3>
<p><strong>Check Downtime</strong> allow centreontrapd to check if the service is not in Downtime status at trap reception. The submission can be cancelled.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s only possible with Centreon Broker and on central monitoring.</p>
</div>
<p>There are three ways to configure this:</p>
<ul class="simple">
<li>None : nothing to do, the trap is sent as normal;</li>
<li>Real-Time : with this option, a trap sent with a current downtime, the service state is not updated;</li>
<li>History : option used to do not acknowledge a trap snmp that concerning a past event during a downtime.</li>
</ul>
</div>
</div>
<div class="section" id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<p>As seen in Chapter <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-snmptrapds"><span class="std std-ref">SNMP traps</span></a>, several elements are involved in the SNMP traps management.
In case of problem, it is necessary to check the proper functioning of its architecture, there are several things to check.</p>
<div class="section" id="sender-settings">
<h3>Sender settings<a class="headerlink" href="#sender-settings" title="Permalink to this headline">¶</a></h3>
<p>The first point is to control the configuration of the equipment or application that issued the trap that you should have received. Check IP address or DNS name, the SNMP community and version.</p>
</div>
<div class="section" id="firewall-routing">
<h3>Firewall, routing<a class="headerlink" href="#firewall-routing" title="Permalink to this headline">¶</a></h3>
<p>The second point is to control network firewalls and software permissions and the implementation of a specific routing. If one or more network firewalls are present or if a port translation and/or IP address is in place, make sure the connection is possible between the emitter and the poller.
The use of network probes, debug network devices (firewalls and routers) or software tcpdump/wireshark on the poller may help you to confirm receipt of data on UDP port 162.</p>
</div>
<div class="section" id="snmptrapd">
<h3>Snmptrapd<a class="headerlink" href="#snmptrapd" title="Permalink to this headline">¶</a></h3>
<p>After validation of the connection, check the operating status of snmptrapd process (which must be running) and its configuration options.
It is possible to enable logging of the process. To do this change the “/etc/sysconfig/snmptrapd.options” file and replace the “OPTIONS” line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># snmptrapd command line options</span>
<span class="c1"># OPTIONS=&quot;-On -d -t -n -p /var/run/snmptrapd.pid&quot;</span>
<span class="n">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-On -Lf /var/log/snmptrapd.log -p /var/run/snmptrapd.pid&quot;</span>
</pre></div>
</div>
<p>Restart the process to take the changes into account. Thus, for any receiving SNMP traps, these events will be listed in the “/var/log/snmptrapd.log” log.</p>
<p>In case you filter by SNMP community, check allowed communities in the configuration file “/etc/snmp/snmptrapd.conf”. If after all these checks, SNMP traps are not included in the log, verify that the process is listening on UDP port 162 for remote equipment using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># netstat -ano | grep 162</span>
<span class="n">udp</span>        <span class="mi">0</span>      <span class="mi">0</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">162</span>             <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="o">*</span>                           <span class="n">off</span> <span class="p">(</span><span class="mf">0.00</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>If not, change the listening port of the process.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Don’t forget to deactivate the logs after your check. Otherwise, the volume of the logs can be very important.</p>
</div>
</div>
<div class="section" id="centreontrapdforward">
<h3>Centreontrapdforward<a class="headerlink" href="#centreontrapdforward" title="Permalink to this headline">¶</a></h3>
<p>Once the snmptrapd process is validated, check the centreontrapdforward process. The first step is to check the access parameters of this process snmptrapd in the file “/etc/snmp/snmptrapd.conf”:</p>
<ul>
<li><p class="first">Check that snmptrapd service executes centreontrapdforward. To do this, edit the file <strong>/etc/snmp/snmptrapd.conf</strong> and verify that its contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">traphandle</span> <span class="n">default</span> <span class="n">su</span> <span class="o">-</span><span class="n">l</span> <span class="n">centreon</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;/usr/share/centreon/bin/centreontrapdforward&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>If path to the file is incorrect, change it and restart the snmptrapd process.
You can check the proper functioning of binary centreontrapdforward by checking the configuration part of <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-centreontrapdforward"><span class="std std-ref">centreontrapdforward</span></a>.</p>
</div>
<div class="section" id="centreontrapd">
<h3>Centreontrapd<a class="headerlink" href="#centreontrapd" title="Permalink to this headline">¶</a></h3>
<p>The next process to check is Centreontrapd. This daemon allows to connect a SNMP trap to a passive service linked to an host in Centreon using IP address or DNS from distant equipment.
To check its operation, you should check the centreontrapd configuration settings.</p>
<p>You can check the proper functioning of binary centreontrapdforward by checking the configuration part of <a class="reference internal" href="../configuration_guide/advanced_configuration/traps.html#configuration-advanced-centreontrapd"><span class="std std-ref">centreontrapd</span></a>.</p>
</div>
<div class="section" id="centcore">
<h3>CentCore<a class="headerlink" href="#centcore" title="Permalink to this headline">¶</a></h3>
<p>CentCore daemon must be running to forward information from Centreontrapd to the monitoring engine as an external command.
Enable the debug mode via <strong>Administration</strong> ==&gt; <strong>Options</strong> ==&gt; <strong>Debug</strong> menu and restart process.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can edit debug severity level in <strong>/etc/sysconfig/centcore</strong> file.</p>
</div>
<p>If any external command are sent to the monitoring engine please check the path to “$cmdFile”” in <strong>/etc/centreon/conf.pm</strong> configuration file.
The path should be <strong>/var/lib/centreon/centcore.cmd</strong> for a central Centreon server.</p>
</div>
<div class="section" id="poller">
<h3>Poller<a class="headerlink" href="#poller" title="Permalink to this headline">¶</a></h3>
<p>The monitoring engine must receive external commands from Centcore process in order to change status and output of the passive service. Please check the event log.
for Centreon Engine, the path is <strong>/var/log/centreon-engine/centengine.log</strong>. you should find lines as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1352838428</span><span class="p">]</span> <span class="n">EXTERNAL</span> <span class="n">COMMAND</span><span class="p">:</span> <span class="n">PROCESS_SERVICE_CHECK_RESULT</span><span class="p">;</span><span class="n">Centreon</span><span class="o">-</span><span class="n">Server</span><span class="p">;</span><span class="n">Traps</span><span class="o">-</span><span class="n">SNMP</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="n">Critical</span> <span class="n">problem</span>
<span class="p">[</span><span class="mi">1352838433</span><span class="p">]</span> <span class="n">PASSIVE</span> <span class="n">SERVICE</span> <span class="n">CHECK</span><span class="p">:</span> <span class="n">Centreon</span><span class="o">-</span><span class="n">Server</span><span class="p">;</span><span class="n">Traps</span><span class="o">-</span><span class="n">SNMP</span><span class="p">;</span><span class="mi">2</span><span class="p">;</span><span class="n">Critical</span> <span class="n">problem</span>
</pre></div>
</div>
<p>If only the external command appears but not the consideration thereof by the scheduler (“PASSIVE SERVICE CHECK”), there may be a system clock problem synchronizing issue.
The server is late and the order will be processed later, either in advance and the order will not be taken into account.</p>
</div>
<div class="section" id="centreon">
<h3>Centreon<a class="headerlink" href="#centreon" title="Permalink to this headline">¶</a></h3>
<p>To display the result in Centreon the monitoring engine must forward using NEB module information to the broker to store them into database.
Centreon will display result from “centreon_storage” database. If you can reach Centreon web interface you must see the change of the output and maybe the status of the passive service.
If any change appears a connection failure between the monitoring engine and the broker can be the root cause of this issue. Problems can be:</p>
<ul class="simple">
<li>The monitoring engine doesn’t load the NEB module to connect to the distant broker.</li>
<li>The NEB module settings are wrong to connect to the distant broker.</li>
<li>A firewall stops the connection.</li>
</ul>
</div>
<div class="section" id="detailed-diagram">
<h3>Detailed diagram<a class="headerlink" href="#detailed-diagram" title="Permalink to this headline">¶</a></h3>
<p>You will find below a detailed diagram of all the processes used and/or present at the reception of an SNMP trap:</p>
<img alt="../_images/kcentreontrapd_schema.png" class="align-center" src="../_images/kcentreontrapd_schema.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Managing SNMP traps with Centreon</a><ul>
<li><a class="reference internal" href="#receive-snmp-traps-with-centreon">Receive SNMP traps with Centreon</a><ul>
<li><a class="reference internal" href="#import-of-snmp-traps">Import of SNMP traps</a></li>
<li><a class="reference internal" href="#create-a-passive-service-template">Create a passive service template</a></li>
<li><a class="reference internal" href="#service-creation">Service creation</a></li>
<li><a class="reference internal" href="#send-an-example-trap">Send an example trap</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modify-the-output">Modify the output</a><ul>
<li><a class="reference internal" href="#use-all-the-arguments">Use all the arguments</a></li>
<li><a class="reference internal" href="#active-checks-after-trap-reception">Active checks after trap reception</a></li>
<li><a class="reference internal" href="#execute-special-command">Execute special command</a></li>
<li><a class="reference internal" href="#use-all-the-arguments-via-oid">Use all the arguments (via OID)</a></li>
<li><a class="reference internal" href="#use-an-external-variable">Use an external variable</a></li>
<li><a class="reference internal" href="#use-a-regular-expression">Use a Regular expression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#route-transfer-snmp-traps">Route/Transfer SNMP traps</a><ul>
<li><a class="reference internal" href="#ignore-snmp-trap-when-resource-is-on-downtime">Ignore SNMP Trap when resource is on downtime</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq">FAQ</a><ul>
<li><a class="reference internal" href="#sender-settings">Sender settings</a></li>
<li><a class="reference internal" href="#firewall-routing">Firewall, routing</a></li>
<li><a class="reference internal" href="#snmptrapd">Snmptrapd</a></li>
<li><a class="reference internal" href="#centreontrapdforward">Centreontrapdforward</a></li>
<li><a class="reference internal" href="#centreontrapd">Centreontrapd</a></li>
<li><a class="reference internal" href="#centcore">CentCore</a></li>
<li><a class="reference internal" href="#poller">Poller</a></li>
<li><a class="reference internal" href="#centreon">Centreon</a></li>
<li><a class="reference internal" href="#detailed-diagram">Detailed diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="02j.html"
                        title="previous chapter">Managing groups and categories</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="02l.html"
                        title="next chapter">Configuring Broker</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/administration_guide/02k.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="02l.html" title="Configuring Broker"
             >next</a> |</li>
        <li class="right" >
          <a href="02j.html" title="Managing groups and categories"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Centreon 2.8.16 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Administration</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2018 Centreon.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>